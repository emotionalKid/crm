<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.zhh.crm.workbench.clue.mapper.ClueMapper" >
  <resultMap id="BaseResultMap" type="com.zhh.crm.workbench.clue.bean.Clue" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Jul 16 15:43:31 CST 2022.
    -->
    <id column="id" property="id" jdbcType="CHAR" />
    <result column="fullname" property="fullname" jdbcType="VARCHAR" />
    <result column="appellation" property="appellation" jdbcType="VARCHAR" />
    <result column="owner" property="owner" jdbcType="CHAR" />
    <result column="company" property="company" jdbcType="VARCHAR" />
    <result column="job" property="job" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="website" property="website" jdbcType="VARCHAR" />
    <result column="mphone" property="mphone" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="VARCHAR" />
    <result column="source" property="source" jdbcType="VARCHAR" />
    <result column="create_by" property="createBy" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="CHAR" />
    <result column="edit_by" property="editBy" jdbcType="VARCHAR" />
    <result column="edit_time" property="editTime" jdbcType="CHAR" />
    <result column="description" property="description" jdbcType="VARCHAR" />
    <result column="contact_summary" property="contactSummary" jdbcType="VARCHAR" />
    <result column="next_contact_time" property="nextContactTime" jdbcType="CHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat Jul 16 15:43:31 CST 2022.
    -->
    id, fullname, appellation, owner, company, job, email, phone, website, mphone, state,
    source, create_by, create_time, edit_by, edit_time, description, contact_summary,
    next_contact_time, address
  </sql>
<!--
    /**
     * 插入clue
     * @param clue
     * @return
     */
    int saveClue(Clue clue);
-->
  <insert id="saveClue" parameterType="com.zhh.crm.workbench.clue.bean.Clue">
    insert into tbl_clue ( id, fullname, appellation, owner, company, job, email, phone, website, mphone, state,source, create_by, create_time, description, contact_summary,next_contact_time, address)
    values (#{id},#{fullname},#{appellation},#{owner},#{company},#{job},#{email},#{phone},#{website},
            #{mphone},#{state},#{source},#{createBy},#{createTime},#{description},#{ contactSummary},
            #{nextContactTime},#{address})
  </insert>
<!--
  /**
     * 根据条件分页查询
     * @param map
     * @return
     */
    List<Clue> selectClueByConditionForPage(Map<String,Object> map);
-->
  <select id="selectClueByConditionForPage" parameterType="map" resultMap="BaseResultMap">
    select c.id,c.fullname,dic2.value as appellation,u1.name as owner,c.company,c.job,c.email,c.phone,c.website,
           c.mphone,dic.value as state,dic1.value as source,u2.name as create_by,c.create_time,u3.name as edit_by,c.edit_time,
           c.description,c.contact_summary,c.next_contact_time,c.address
        from tbl_clue c
               join tbl_user u1 on c.owner=u1.id
               join tbl_dictionary_value dic on c.state=dic.id
               join tbl_dictionary_value dic1 on c.source=dic1.id
               join tbl_dictionary_value dic2 on c.appellation=dic2.id
               join tbl_user u2 on c.create_by=u2.id
               left join  tbl_user u3 on c.edit_by=u3.id
        <where>
          <if test="fullname!=null and fullname!=''">
              and c.fullname like concat('%',#{fullname},'%')
          </if>
          <if test="company!=null and company!=''">
              and c.company like concat('%',#{company},'%')
          </if>
          <if test="phone!=null and phone!=''">
              and c.phone like concat('%',#{phone},'%')
          </if>
          <if test="source!=null and source!=''">
              and c.source like concat('%',#{source},'%')
          </if>
            <if test="owner!=null and owner!=''">
                and c.owner like concat('%',#{owner},'%')
            </if>
            <if test="mphone!=null and mphone!=''">
                and c.mphone like concat('%',#{mphone},'%')
            </if>
            <if test="state!=null and state!=''">
                and c.state like concat('%',#{state},'%')
            </if>
        </where>
      order by c.create_time desc
      limit #{beginNo},#{pageSize}
  </select>
<!--
 /**
         /**
     * 查询clue总条数
     * @return
     */
    int selectClueAccount(Map<String,Object> map);
-->
    <select id="selectClueAccount"  parameterType="map" resultType="int">
        select count(*)
        from tbl_clue c
        join tbl_user u1 on c.owner=u1.id
        join tbl_dictionary_value dic on c.state=dic.id
        join tbl_dictionary_value dic1 on c.source=dic1.id
        join tbl_dictionary_value dic2 on c.appellation=dic2.id
        join tbl_user u2 on c.create_by=u2.id
        left join  tbl_user u3 on c.edit_by=u3.id
        <where>
            <if test="fullname!=null and fullname!=''">
                and c.fullname like concat('%',#{fullname},'%')
            </if>
            <if test="company!=null and company!=''">
                and c.company like concat('%',#{company},'%')
            </if>
            <if test="phone!=null and phone!=''">
                and c.phone like concat('%',#{phone},'%')
            </if>
            <if test="source!=null and source!=''">
                and c.source like concat('%',#{source},'%')
            </if>
            <if test="owner!=null and owner!=''">
                and c.owner like concat('%',#{owner},'%')
            </if>
            <if test="mphone!=null and mphone!=''">
                and c.mphone like concat('%',#{mphone},'%')
            </if>
            <if test="state!=null and state!=''">
                and c.state like concat('%',#{state},'%')
            </if>
        </where>
    </select>
</mapper>
